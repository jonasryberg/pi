
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Intervallfoto 2.0 - Jonas@pi</title>
  <meta name="author" content="Jonas Ryberg">

  
  <meta name="description" content="I förra inlägget berättade jag hur jag och min bror biologen styrde min Raspberry pi-kamera via en webbserver. Nästa steg är att på ett enkelt sätt &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://pi.ryberg.org/blog/2013/11/10/intervallfoto-2-0">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Jonas@pi" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Jonas@pi</a></h1>
  
    <h2>Nördiga bloggerier.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:pi.ryberg.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blogg</a></li>
  <li><a href="/blog/archives">Arkiv</a></li>
  <li><a href="/om">Om bloggen</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Intervallfoto 2.0</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-10T14:06:59+00:00" pubdate data-updated="true">Nov 10<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I förra <a href="http://pi.ryberg.org/blog/2013/10/26/webbstyrd-pi-kamera/">inlägget</a> berättade jag hur jag och min bror biologen styrde min Raspberry pi-kamera via en webbserver. Nästa steg är att på ett enkelt sätt få den att ta intervallbilder för att skapa en enkel stop-motion-film. Tanken är förstås att kunna placera ut Pi:n på ett lämpligt ställe, kolla att allt ser bra ut genom att ta en bild och sedan sätta igång intervallfotot. För att göra det enklare ska vi också låta Pi:en räkna ut hur många bilder den behöver ta för att skapa en film av en viss längd.</p>

<!-- more -->


<p>Första steget är att ändra den ursprungliga webbsidan något så att det blir möjligt att ange under vilken tidsperiod kameran ska fotografera och hur lång den slutliga filmen ska bli.</p>

<p>Ungefär så här blir koden till sidan då:</p>

<pre><code>&lt;html&gt;&lt;form method="get" action="/cgi-bin/kamera.cgi"&gt;&lt;input type="submit" value="Ta bild"&gt;&lt;/form&gt;
&lt;br&gt;&lt;br&gt;
&lt;form method="get" action="/cgi-bin/timelaps.cgi"&gt;Film längd: &lt;input type="text" name="film_langd" value="1"min&lt;br&gt;
Inspelnings längd: &lt;input type="text" name="insp_tid" value="1"h&lt;br&gt;&lt;input type="submit" value="intervallfoto"&gt;&lt;/form
&lt;/html&gt;
</code></pre>

<p>Nästa steg är att se till att det finns ett perl-script som kan hämta värdena som matats in i webbformuläret och be kameran att starta intervallfotot. I exemplet har vi döpt den filen till timelaps.cgi. Koden i filen ser ut så här:</p>

<pre><code>#! /usr/bin/perl
use strict;
print "Content-type: text/html\n\n";
my $film_langd;
my $insp_tid;
if ($ENV{'QUERY_STRING'} =~ /film_langd=([0-9\.]+)/) { $film_langd=$1; }
if ($ENV{'QUERY_STRING'} =~ /insp_tid=([0-9\.]+)/) { $insp_tid=$1; }
print "&lt;html&gt;";
$insp_tid *= 3600000;
my $intervall= $insp_tid/($film_langd*60*24);
print "&lt;p&gt;sudo /usr/bin/raspistill -o \"/var/www/pictures/ivbild%i.jpg\" -t $insp_tid -vf -hf -w 1920 -h 1080 -tl $intervall -n&lt;/p&gt;";
system "sudo /usr/bin/raspistill -o \"/var/www/pictures/ivbild%i.jpg\" -t $insp_tid -vf -hf -w 1920 -h 1080 -tl $intervall -n";
print "&lt;p&gt;H&amp;auml;r &amp;aumlr din.&lt;/p&gt;";
print '&lt;a href="/pictures/film.h264"&gt;film!&lt;/a&gt;';
print "&lt;/html&gt;";
</code></pre>

<p>Koden räknar ut hur många bilder som ska tas för att det ska gå att skapa en film av önskad längd med 24 bilder per sekund. Om man väljer för kort filmtid i förhållande till inspelningstiden blir det problem eftersom kameran inte hinner ta bilderna tillräckligt fort. I praktiken är det dock knappast ett problem.</p>

<p>Jag passade också på att lägga in en knapp för att slå av pi:n när plåtandet är klart. Den koden finns här:</p>

<pre><code>#! /usr/bin/perl 
system "sudo /sbin/shutdown -h now";
</code></pre>

<p>Glöm inte att köra <code>chmod +x</code> på alla filerna med kod så att webservern kan starta dem.</p>

<p>Här är resultatet av mitt första test. Jag har använt programmet mencoder för att foga samman bilderna till en film, kolla <a href="http://pi.ryberg.org/texter/intervallfoto_med_Raspberry_Pi">den här texten</a> om du vill veta hur.</p>

<iframe width="560" height="315" src="//www.youtube.com/embed/akjcLrhI0mM" frameborder="0" allowfullscreen></iframe>



</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jonas Ryberg</span></span>

      








  


<time datetime="2013-11-10T14:06:59+00:00" pubdate data-updated="true">Nov 10<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/raspberry-pi/'>Raspberry_Pi</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://pi.ryberg.org/blog/2013/11/10/intervallfoto-2-0/" data-via="" data-counturl="http://pi.ryberg.org/blog/2013/11/10/intervallfoto-2-0/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/10/26/webbstyrd-pi-kamera/" title="Previous Post: Webbstyrd pi-kamera">&laquo; Webbstyrd pi-kamera</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/11/10/intervallfoto-2-0/">Intervallfoto 2.0</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/26/webbstyrd-pi-kamera/">Webbstyrd Pi-kamera</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/26/intervallfoto-med-rasoberry-pi/">Intervallfoto Med Raspberry Pi</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/21/emil-bygger-tandborstrobot/">Emil Bygger Tandborstrobot</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/06/wordpress-pa-raspberry-pi/">WordPress På Raspberry Pi</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Jonas Ryberg -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
